"use strict";(self.webpackChunkmaterial_module=self.webpackChunkmaterial_module||[]).push([["638"],{3919(e,l,t){t.d(l,{E:()=>r,P:()=>s});var a=t(8048),i=t(268);let s=[{label:"横版",value:16/9},{label:"正方形",value:1},{label:"竖版",value:9/16},{label:"插页矩形",value:1.2},{label:"大横幅",value:3.2},{label:"小横幅",value:6.4}];function r(e){let{value:l,onChange:t,includeAllOption:r=!1}=e;return(0,a.jsx)(i.Select,{className:"w-48",options:[...r?[{label:"全部",value:0}]:[],...s],value:l,onChange:e=>{t(e)},allowClear:r})}},5175(e,l,t){t.d(l,{H:()=>i});var a=t(8048);function i(e){let{format:l}=e;return l?(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[l.width," x ",l.height]}):null}},7275(e,l,t){t.d(l,{_:()=>d});var a=t(8048),i=t(9400),s=t.n(i),r=t(268),n=t(8034),o=t(1987);function d(e){let{src:l,alt:t,width:i,height:d,className:c,backgroundColor:u="#f8f8f9",enablePreview:p=!0,closeable:m=!1,onClose:f}=e,[h,x]=(0,n.useState)(!1);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:s()("rounded-md relative aspect-square",c),style:{background:u},onClick:e=>{p&&e.stopPropagation()},children:[(0,a.jsx)("img",{src:l,alt:t,className:"w-full h-full object-contain",width:i,height:d,onClick:e=>{p&&(e.stopPropagation(),x(!0))}}),m&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 z-10 cursor-pointer",children:(0,a.jsx)(o.A,{theme:"filled",size:"12",fill:"#50e3c2",onClick:()=>{null==f||f(),x(!1)}})}),(0,a.jsx)("div",{className:"absolute",children:(0,a.jsx)(r.Image,{src:l,alt:t,className:"hidden",width:i,height:d,preview:{visible:h,onVisibleChange:x}})})]})})}},2462(e,l,t){t.d(l,{PF:()=>r,hz:()=>s});var a=t(8034);let i=(0,a.createContext)({repo:"",selectedFiles:[],setSelectedFiles:()=>{}}),s=i.Provider,r=()=>(0,a.useContext)(i)},24(e,l,t){t.d(l,{o:()=>a});function a(e){let{selectedFiles:l,setCurrentStep:t,onClose:a}=e;return{0:{stepIndex:1,title:"选择图片",nextStep:1,prevButton:{text:"返回",onClick:a},nextButton:{text:"下一步",disabled:0===l.length,onClick:()=>t(1)}},1:{stepIndex:2,title:"裁剪图片",nextStep:2,prevButton:{text:"取消",onClick:()=>t(0)},nextButton:{text:"确认",disabled:0===l.length,onClick:()=>t(2)}},2:{stepIndex:3,title:"上传图片",nextStep:0,prevButton:{text:"返回",onClick:()=>t(0)},nextButton:{text:"完成",disabled:0===l.length,onClick:a}}}}},9768(e,l,t){t.d(l,{D:()=>m});var a=t(8048),i=t(8034),s=t(6083),r=t(2462),n=t(7275),o=t(5175),d=t(8509),c=t(9400),u=t.n(c),p=t(3919);function m(){let{selectedFiles:e,setSelectedFiles:l}=(0,r.PF)(),[t,c]=(0,i.useState)(()=>{var l;return null==(l=e[0])?void 0:l.uploadId}),m=(0,i.useMemo)(()=>e.find(e=>e.uploadId===t),[e,t]),f=(0,i.useMemo)(()=>null==m?void 0:m.originalFile,[m]),h=(0,i.useMemo)(()=>null==m?void 0:m.croppedFile,[m]);console.log("currentOriginalFile:",f,h);let x=(0,i.useMemo)(()=>{let e=p.P.find(e=>e.value===(null==m?void 0:m.ratio));return(null==e?void 0:e.value)||p.P["0"].value},[m]);console.log("currentRatio:",x);let[g,v]=(0,i.useState)({x:2,y:2}),[j,w]=(0,i.useState)(1),b=(0,i.useRef)(null);return(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-36 flex flex-col gap-4",children:e.map(e=>{var l;return(0,a.jsx)("div",{className:u()("bg-gray-100 flex gap-3 items-center aspect-square rounded-md cursor-pointer",{"border border-solid border-gray-400":e.uploadId===t}),onClick:()=>c(e.uploadId),children:(0,a.jsx)(n._,{src:null==(l=e.originalFile)?void 0:l.url,alt:e.originalFile.file.name,enablePreview:!1})},e.uploadId)})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{children:(0,a.jsx)(p.E,{value:x,onChange:a=>{l([...e.map(e=>e.uploadId===t?{...e,ratio:a}:e)])}})})]}),(0,a.jsx)("div",{className:"w-full h-96 relative",children:f&&(0,a.jsx)(s.Ay,{ref:b,showGrid:!0,objectFit:"contain",style:{containerStyle:{width:"100%",height:"460px"}},image:f.url,crop:g,zoom:j,aspect:x,onCropChange:v,onZoomChange:w,onCropComplete:async(a,i)=>{let s=await (0,d.n)(f.url,i,0,f.file.name);l([...e.map(e=>e.uploadId===t?{...e,croppedFile:{file:s.file,type:s.type,format:s.format,url:URL.createObjectURL(s.file)}}:e)])}},x)})]}),(0,a.jsxs)("div",{className:"w-48 flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:"预览"}),h&&(0,a.jsx)(n._,{src:h.url,alt:(null==f?void 0:f.file.name)||"",className:"w-full aspect-square overflow-hidden",enablePreview:!0})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:"尺寸"}),(0,a.jsx)(o.H,{format:(null==h?void 0:h.format)||(null==f?void 0:f.format)})]})]})]})}},2258(e,l,t){t.d(l,{q:()=>m});var a=t(8048),i=t(8034),s=t(2462),r=t(7275),n=t(5175),o=t(7471),d=t(8574),c=t(6188),u=t(9240),p=t(268);function m(){let{repo:e,selectedFiles:l,setSelectedFiles:t}=(0,s.PF)(),m=async l=>{let a=new FormData;if(l.croppedFile){var i,s,r,n;a.append("file",null==(i=l.croppedFile)?void 0:i.file),a.append("repo",e),a.append("format",(null==(s=l.croppedFile)?void 0:s.format.width)+"x"+(null==(r=l.croppedFile)?void 0:r.format.height)),a.append("type",null==(n=l.croppedFile)?void 0:n.type)}(0,u.Fq)(a,{onUploadProgress:e=>{l.uploadInfo={progress:Math.round(100*e.loaded/(e.total||1))-20,status:"uploading"},t(e=>{let t=[...e];return t[t.indexOf(l)]=l,t})}}).then(e=>{0===e.code?l.uploadInfo={progress:100,status:"success"}:(p.message.error("上传失败,"+e.message,10),l.uploadInfo={progress:100,status:"error",message:e.message}),t(e=>{let t=[...e];return t[t.indexOf(l)]=l,t})}).catch(e=>{p.message.error("上传失败,"+e.message,10),l.uploadInfo={progress:0,status:"error"},t(e=>{let t=[...e];return t[t.indexOf(l)]=l,t})})};return(0,i.useEffect)(()=>{l.filter(e=>!e.uploadInfo).forEach(e=>{m(e)})},[]),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"flex flex-col gap-4",style:{width:660},children:l.map(e=>{var l,t,i,s,u,f,h,x,g,v;return(0,a.jsxs)("div",{className:"p-3 rounded-md bg-gray-100 flex items-center gap-4 overflow-hidden",children:[(0,a.jsx)(r._,{src:(null==(l=e.croppedFile)?void 0:l.url)||"",className:"w-18 h-18",enablePreview:!1}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 flex-1 overflow-hidden",children:[(0,a.jsx)("span",{className:"text-lg font-bold truncate",children:null==(i=e.originalFile)||null==(t=i.file)?void 0:t.name}),(0,a.jsx)(n.H,{format:null==(s=e.croppedFile)?void 0:s.format}),(null==(u=e.uploadInfo)?void 0:u.status)==="uploading"&&(0,a.jsx)(p.Progress,{percent:(null==(f=e.uploadInfo)?void 0:f.progress)||0,size:"small",showInfo:!1,trailColor:(null==(h=e.uploadInfo)?void 0:h.progress)<50?"#f3f3f3":"#e0e0e0"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(null==(x=e.uploadInfo)?void 0:x.status)==="success"&&(0,a.jsx)(o.A,{theme:"filled",size:18,fill:"green"}),(null==(g=e.uploadInfo)?void 0:g.status)==="error"&&(0,a.jsx)(p.Tooltip,{title:(null==(v=e.uploadInfo)?void 0:v.message)||"",children:(0,a.jsx)(d.A,{theme:"filled",size:"24",fill:"red",className:"cursor-pointer",onClick:()=>m(e)})}),(0,a.jsx)(c.A,{size:18})]})]},e.uploadId)})})})}},3641(e,l,t){t.d(l,{W:()=>h});var a=t(8048),i=t(8034),s=t(1692),r=t(8215),n=t(6188),o=t(7275),d=t(5175),c=t(8509),u=t(2462),p=t(142),m=t(268);function f(e){let{name:l,onSubmit:t,onCancel:s}=e,[r,n]=(0,i.useState)(l);return(0,a.jsxs)("div",{className:"flex flex-col items-start gap-4",style:{width:400},children:[(0,a.jsx)("div",{children:"素材名称"}),(0,a.jsx)(m.Input,{value:r,onChange:e=>n(e.target.value)}),(0,a.jsxs)("div",{className:"flex gap-4 justify-end w-full",children:[(0,a.jsx)(m.Button,{size:"small",onClick:()=>s(),children:"取消"}),(0,a.jsx)(m.Button,{size:"small",type:"primary",onClick:()=>t(r),children:"确定"})]})]})}function h(){let{selectedFiles:e,setSelectedFiles:l}=(0,u.PF)(),t=(0,i.useRef)(null),[h,x]=(0,i.useState)("");return(0,a.jsxs)("div",{className:"my-4 flex flex-col gap-8",children:[(0,a.jsxs)("div",{className:"h-40 flex flex-col gap-2 items-center justify-center border border-dashed border-gray-300 rounded-md cursor-pointer hover:border-gray-600",style:{width:660},onClick:()=>{var e;return null==(e=t.current)?void 0:e.click()},children:[(0,a.jsx)(s.A,{size:32,className:"text-gray-400"}),(0,a.jsx)("span",{className:"ml-2 text-gray-400",children:"请选择要上传的素材"}),(0,a.jsx)("input",{ref:t,type:"file",className:"hidden",onChange:async e=>{let a=e.target.files;if(null==a?void 0:a.length){let e=a[0],t=await (0,c.p)(e);l(l=>[...l,{uploadId:(0,p.Ak)(),originalFile:{file:e,format:t,url:URL.createObjectURL(e)},ratio:t.width/t.height}])}setTimeout(()=>{t.current&&(t.current.value="")},300)}})]}),(0,a.jsx)("div",{className:"flex flex-col gap-4",style:{width:660},children:e.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-gray-100 flex gap-3 items-center",children:[(0,a.jsx)(o._,{src:e.originalFile.url,alt:e.originalFile.file.name,className:"w-12 h-12",enablePreview:!1}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 flex-1",children:[(0,a.jsxs)("div",{className:"font-medium flex items-center gap-1",children:[(0,a.jsx)("span",{children:e.originalFile.file.name}),(0,a.jsx)(m.Popover,{open:h===e.uploadId,title:(0,a.jsx)(f,{name:e.originalFile.file.name,onSubmit:t=>{l(l=>{var a;let i=[...l],s=i.findIndex(l=>l.uploadId===e.uploadId);return -1!==s&&(i[s].originalFile.file=new File([a=i[s].originalFile.file],t,{type:a.type,lastModified:a.lastModified})),i}),x("")},onCancel:()=>{x("")}}),children:(0,a.jsx)(r.A,{className:" cursor-pointer",size:14,onClick:()=>x(e.uploadId)})})]}),(0,a.jsx)(d.H,{format:e.originalFile.format})]}),(0,a.jsx)(n.A,{className:"cursor-pointer",onClick:()=>l(l=>l.filter(l=>l.originalFile.file.name!==e.originalFile.file.name))})]},e.originalFile.file.name))})]})}},9240(e,l,t){t.d(l,{Jw:()=>n,Fq:()=>o,X6:()=>d});var a=t(8187),i=t(3181),s=t(9552);let r=function(e){let{baseURL:l,onRequest:t,onResponse:r}=e||{},n=a.A.create({baseURL:l});return(0,i.h)(n).plugin((0,s.r)({max:3})),n.interceptors.request.use(e=>t?t(e):e),n.interceptors.response.use(e=>(null==r||r(e),e.status>=200&&e.status<300)?Promise.resolve(e.data):Promise.reject(e)),n}({baseURL:"https://www.levenx.com"}),n=e=>r.get("/admin/material/item",{params:e}),o=(e,l)=>r.post("/admin/material/upload/new",e,{onUploadProgress:e=>{var t;null==l||null==(t=l.onUploadProgress)||t.call(l,e)}}),d=e=>r.post("/admin/material/item/delete/batch",{ids:e})},8509(e,l,t){async function a(e){let l=URL.createObjectURL(e),t=new Image;return new Promise((e,a)=>{t.onload=function(){e({width:t.width,height:t.height}),URL.revokeObjectURL(l)},t.onerror=a,t.src=l})}async function i(e,l){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,i=await new Promise((l,t)=>{let a=new Image;a.addEventListener("load",()=>l(a)),a.addEventListener("error",e=>t(e)),a.setAttribute("crossOrigin","anonymous"),a.src=e}),s=document.createElement("canvas"),r=s.getContext("2d");if(!r)throw Error("Canvas context is not available");let n=Math.max(i.width,i.height)/2*Math.sqrt(2)*2;s.width=n,s.height=n,r.translate(n/2,n/2),r.rotate(t*Math.PI/180),r.translate(-n/2,-n/2),r.drawImage(i,n/2-.5*i.width,n/2-.5*i.height);let o=r.getImageData(0,0,n,n);return s.width=l.width,s.height=l.height,r.putImageData(o,Math.round(0-n/2+.5*i.width-l.x),Math.round(0-n/2+.5*i.height-l.y)),{file:await new Promise(e=>{s.toBlob(l=>{if(!l)throw Error("Canvas to blob conversion failed");e(new File([l],a.split(".")[0]+".webp",{type:"image/webp"}))},"image/webp")}),type:"image/webp",format:{width:l.width,height:l.height}}}t.d(l,{n:()=>i,p:()=>a})},1205(){}}]);