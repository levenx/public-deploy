"use strict";(self.webpackChunkmaterial_module=self.webpackChunkmaterial_module||[]).push([["508"],{3047(){},1319(e,l,t){t.d(l,{A:()=>n});var s=t(5972),r=t(9240),a=t(8034);function n(e){let l,{pn:t,ps:n,repo:i,keyword:c,ratio:d,status:o}=e||{},[u,x]=(0,a.useState)(0);console.log("total",u);let{fetchNextPage:f,hasNextPage:h,isFetchingNextPage:m,isPending:g,data:p,refetch:v}=(0,s.q)({queryKey:["getMaterialItem",i,c,d],queryFn:e=>{let{pageParam:l=1}=e;return(0,r.Jw)({pn:l,ps:n,repo:i,keyword:c,ratio:d,status:o}).then(e=>(x(e.data.total),e.data.list||[]))},initialPageParam:t,refetchOnMount:!0,getNextPageParam:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(null==e?void 0:e.length)?l.length+1:null}}),j=(0,a.useMemo)(()=>(null==p?void 0:p.pages.flat())||[],[p]),y=(0,a.useCallback)(()=>v(),[v]);return{dataSource:j,hasNextPage:h,fetchNextPage:(l=(0,a.useRef)(),function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];clearTimeout(l.current),l.current=window.setTimeout(()=>{f(...t)},600)}),reload:y,total:u||j.length,isLoading:m||g}}},3271(e,l,t){t.r(l),t.d(l,{MaterialPicker:()=>j,MaterialPickerFeature:()=>p,MaterialPickerScene:()=>v,default:()=>y});var s,r,a=t(8048),n=t(268),i=t(8034),c=t(7999),d=t(4451),o=t(1319),u=t(3467),x=t(9240),f=t(9158),h=t(7275);t(3047);var m=t(7362);let g=window.queryClient;g||(g=new c.E,window.queryClient=g);var p=((s={}).Uploader="uploader",s.Delete="delete",s.Selector="selector",s),v=((r={}).Creator="creator",r.Trash="trash",r);function j(e){let{scene:l="creator",repo:t,open:s,onClose:r,selectLimit:c=1,onSelect:d,features:g=[]}=e,[p,v]=(0,i.useState)(!1),[j,y]=(0,i.useState)({ratio:"0",keyword:""}),{dataSource:w,total:b,fetchNextPage:N,reload:k,isLoading:C}=(0,o.A)({pn:1,ps:40,repo:t,keyword:j.keyword,ratio:j.ratio,status:"creator"===l?1:void 0}),[S,B]=(0,i.useState)([]),{mutate:M,isPending:P}=(0,f.n)({mutationFn:x.X6,onSuccess:()=>{n.message.success("删除成功"),B([]),k()}}),q=(0,i.useMemo)(()=>S.map(e=>w.find(l=>l.id===e)).filter(e=>!!e),[S,w]),A=(0,i.useMemo)(()=>g.includes("selector")||g.includes("delete"),[g]);return(0,a.jsxs)(n.Drawer,{placement:"right",size:"large",onClose:r,open:s,title:null,closable:!1,width:980,bodyStyle:{padding:0},classNames:{body:"flex flex-col overflow-hidden"},children:[(0,a.jsxs)("div",{style:{background:"#f8f8f9"},className:"flex items-center justify-between px-6 py-3 m-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"素材库"}),(0,a.jsxs)("span",{className:"text-xs",children:[w.length,"/",b," 条素材"]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[g.includes("delete")&&(0,a.jsxs)(n.Button,{disabled:0===S.length,onClick:()=>{M(S)},loading:P,children:["删除",S.length>0&&(0,a.jsxs)("span",{children:["(",S.length,")"]})]}),g.includes("uploader")&&(0,a.jsx)(n.Button,{type:"primary",onClick:()=>{v(!0)},children:"上传"})]})]}),(0,a.jsx)(m.A,{dataSource:w,checkedIds:S,setCheckedIds:B,selectLimit:c,onLoadMore:()=>{N()},isLoading:C,showCheckbox:A,filterValue:j,onFilterChange:y}),!!q.length&&g.includes("selector")&&(0,a.jsxs)("div",{style:{background:"#f8f8f9"},className:"p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-gray-900",children:0===q.length?"请选择素材":`已选择 ${q.length} 个素材`}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:q.map(e=>(0,a.jsx)(h._,{src:`${e.prefix}/${e.fileKey}`,alt:e.fileName,className:"w-12 h-12 object-cover",backgroundColor:"var(--color-gray-200)",closeable:!0,onClose:()=>{B(S.filter(l=>l!==e.id))}},e.id))})]}),(0,a.jsx)("div",{children:(0,a.jsx)(n.Button,{type:"primary",onClick:()=>{null==d||d(q),B([]),r()},children:"确认选择"})})]}),g.includes("uploader")&&(0,a.jsx)(u.default,{repo:t,open:p,onClose:()=>{v(!1),k()}})]})}function y(e){return(0,a.jsx)(d.Ht,{client:g,children:(0,a.jsx)(j,{...e})})}},7362(e,l,t){t.d(l,{A:()=>d});var s=t(8048),r=t(268),a=t(7275),n=t(8034),i=t(3089),c=t(3919);function d(e){let{dataSource:l,checkedIds:t,setCheckedIds:d,selectLimit:o,onLoadMore:u,isLoading:x,showCheckbox:f,filterValue:h,onFilterChange:m}=e,g=(0,n.useRef)(null),[p,v]=(0,n.useState)((null==h?void 0:h.keyword)||"");return(0,n.useEffect)(()=>{var e;let l=e=>{var l,t,s;let r=(null==(l=e.target)?void 0:l.scrollHeight)||0,a=(null==(t=e.target)?void 0:t.scrollTop)||0;((null==(s=e.target)?void 0:s.offsetHeight)||0)+a+20>=r&&u()};return null==(e=g.current)||e.addEventListener("scroll",l),()=>{var e;null==(e=g.current)||e.removeEventListener("scroll",l)}},[]),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 flex gap-4 items-center",children:[(0,s.jsx)(c.E,{includeAllOption:!0,value:Number((null==h?void 0:h.ratio)||0),onChange:e=>{null==m||m({...h,ratio:e.toString()})}}),(0,s.jsx)("div",{className:"w-48",children:(0,s.jsx)(r.Input.Search,{width:200,placeholder:"搜索素材",allowClear:!0,value:p,onChange:e=>{v(e.target.value)},onSearch:e=>{v(e),null==m||m({...h,keyword:e})}})})]}),(0,s.jsx)("div",{ref:g,className:"grid grid-cols-5 px-4 pb-4 gap-4 overflow-auto",children:l.map(e=>{let l=t.includes(e.id),n=!l&&t.length>=o;return(0,s.jsxs)("div",{className:"w-full flex flex-col items-center justify-center",children:[(0,s.jsxs)("div",{className:"w-full aspect-square relative p-4 cursor-pointer flex items-center justify-center",style:{background:"#f8f8f9"},onClick:()=>{n||(l?d(t.filter(l=>l!==e.id)):d([...t,e.id]))},children:[f&&(0,s.jsx)(r.Checkbox,{className:"absolute top-1 right-1 z-10",checked:t.includes(e.id),disabled:n,onChange:l=>{d(l.target.checked?[...t,e.id]:t.filter(l=>l!==e.id))}}),(0,s.jsx)(a._,{src:`${e.prefix}/${e.fileKey}`,alt:e.fileName,className:"object-cover w-full"}),e.format&&(0,s.jsx)("div",{className:"absolute bottom-1 right-1 text-xs text-white bg-black px-1 py-0.5 rounded",children:e.format})]},e.id),(0,s.jsx)("div",{className:"truncate w-full mt-1",children:e.fileName})]},e.id)})}),x&&(0,s.jsx)("div",{className:"w-full flex items-center justify-center px-4",children:(0,s.jsx)(i.Z,{})})]})}},3089(e,l,t){t.d(l,{Z:()=>r});var s=t(8048);function r(){return(0,s.jsx)("div",{className:"w-full grid grid-cols-5 gap-4",children:Array.from({length:5}).map((e,l)=>(0,s.jsx)("div",{className:"w-full aspect-square rounded-md",style:{background:"#f8f8f9"}},l))})}},3467(e,l,t){t.r(l),t.d(l,{default:()=>u});var s=t(8048),r=t(8034),a=t(268),n=t(3641),i=t(9768),c=t(2258),d=t(2462),o=t(24);function u(e){let{repo:l,open:t,onClose:u}=e,[x,f]=(0,r.useState)(0),[h,m]=(0,r.useState)([]),g=(0,o.o)({selectedFiles:h,setCurrentStep:f,onClose:u})[x];return console.log("selectedFiles:",h),(0,s.jsx)(d.hz,{value:{repo:l,selectedFiles:h,setSelectedFiles:m},children:(0,s.jsxs)(a.Drawer,{title:"素材上传",width:1080,closable:!1,onClose:()=>u(),open:t,footer:null,classNames:{body:"flex flex-col !p-0"},children:[(0,s.jsxs)("div",{className:"p-4 flex-1",children:[(0,s.jsxs)("div",{className:"text-md font-medium flex items-center gap-1",children:[(0,s.jsxs)("span",{children:["第 ",x+1," 步 (共",3,"步):"]}),(0,s.jsx)("span",{children:g.title})]}),(0,s.jsxs)("div",{className:"mt-4",children:[0===x&&(0,s.jsx)(n.W,{}),1===x&&(0,s.jsx)(i.D,{}),2===x&&(0,s.jsx)(c.q,{})]})]}),(0,s.jsxs)("div",{className:"h-20 border-t border-solid border-gray-200 flex items-center justify-between px-4",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a.Button,{onClick:()=>{g.prevButton.onClick()},children:g.prevButton.text}),(0,s.jsx)(a.Button,{type:"primary",disabled:g.nextButton.disabled,onClick:()=>{2===x?(f(0),u(),m([])):f(x+1)},children:g.nextButton.text})]})]})]})})}}}]);