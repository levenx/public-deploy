"use strict";(self.webpackChunk_portal_material_module=self.webpackChunk_portal_material_module||[]).push([["414"],{2755(){},5497(){},1580(e,l,t){t.r(l),t.d(l,{default:()=>m});var s=t(5270),r=t(4508),a=t(3271),n=t(5456),i=t(6239),o=t(3406),c=t(395),d=t.n(c),u=t(2833);function m(e){let{repo:l,value:t=[],onChange:c,limit:m=1,style:f,className:x,pickerType:p="drawer",defaultRatio:h=1.78,drawerProps:j}=e||{},[g,k]=(0,r.useState)(!1),v=!Array.isArray(t),y=v?[t]:t;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:d()("upload-form-input-container",x),style:f,children:[null==y?void 0:y.map((e,l)=>(0,s.jsxs)("div",{className:"flex items-center justify-center aspect-square rounded-md cursor-pointer relative",style:{background:"#efefef"},children:[(0,s.jsx)("img",{src:e,alt:"",className:"rounded-md"}),(0,s.jsx)(i.A,{theme:"filled",size:"18",fill:"#50e3c2",className:"absolute -top-2 -right-1 cursor-pointer",onClick:()=>{let e=[...y];e.splice(l,1),null==c||c(e)}})]},e)),(m>(null==y?void 0:y.length)||!(null==y?void 0:y.length))&&(0,s.jsx)("div",{onClick:()=>{k(!0)},className:"flex items-center justify-center space-x-2 aspect-square rounded-md cursor-pointer",style:{background:"#efefef"},children:(0,s.jsx)(o.A,{fill:"rgb(193, 193, 193)",size:32})})]}),"drawer"===p&&(0,s.jsx)(a.default,{repo:l,open:g,onClose:()=>{k(!1)},selectLimit:m-(null==t?void 0:t.length),onSelect:e=>{k(!1);let l=v?(0,u.ID)(e[0]):[...t||[],...e.map(e=>(0,u.ID)(e))];null==c||c(l)},features:[a.MaterialPickerFeature.Selector,a.MaterialPickerFeature.Uploader],source:"console",className:null==j?void 0:j.className,zIndex:null==j?void 0:j.zIndex,defaultRatio:h}),"modal"===p&&(0,s.jsx)(n.A,{repo:l,defaultRatio:h,open:g,onClose:()=>{k(!1)},selectLimit:m-(null==t?void 0:t.length),onSelect:e=>{k(!1);let l=v?(0,u.ID)(e[0]):[...t||[],...e.map(e=>(0,u.ID)(e))];null==c||c(l)}})]})}t(2755),t(3919)},5456(e,l,t){t.d(l,{A:()=>f});var s=t(5270),r=t(8628),a=t(4262),n=t(7362),i=t(1319),o=t(4508),c=t(6645),d=t(3271),u=t(7275);function m(e){let{repo:l,defaultRatio:t,open:c,onClose:d,selectLimit:m=1,onSelect:f}=e,[x,p]=(0,o.useState)({ratio:null==t?void 0:t.toString(),keyword:"",sorter:["updatedAt","DESC"]}),{dataSource:h,total:j,fetchNextPage:g,isLoading:k}=(0,i.A)({pn:1,ps:40,repo:l,keyword:x.keyword,ratio:x.ratio,sorter:x.sorter,status:1,enableRequest:c}),[v,y]=(0,o.useState)([]),b=(0,o.useMemo)(()=>v.map(e=>h.find(l=>l.id===e)).filter(e=>!!e),[v,h]);return(0,s.jsxs)(r.Modal,{width:980,title:null,footer:null,closable:!1,className:"material-modal",open:c,onCancel:d,onOk:d,okText:"确认",cancelText:"取消",centered:!0,children:[(0,s.jsx)(a.A,{title:"素材库",subtitle:`${h.length}/${j} 条素材`}),(0,s.jsx)(n.A,{dataSource:h,checkedIds:v,setCheckedIds:y,selectLimit:m,onLoadMore:()=>{g({})},isLoading:k,showCheckbox:!0,filterValue:x,onFilterChange:p,enablePreview:!1,enableEdit:!1}),(0,s.jsxs)("div",{style:{background:"#f8f8f9"},className:"p-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-900",children:0===b.length?"请选择素材":`已选择 ${b.length} 个素材`}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:b.map(e=>(0,s.jsx)(u._,{src:`${e.prefix}/${e.fileKey}`,alt:e.fileName,className:"w-12 h-12 object-cover",backgroundColor:"var(--color-gray-200)",closeable:!0,onClose:()=>{y(v.filter(l=>l!==e.id))}},e.id))})]}),(0,s.jsx)("div",{children:(0,s.jsx)(r.Button,{type:"primary",onClick:()=>{null==f||f(b),y([]),d()},children:"确认选择"})})]})]})}function f(e){return(0,s.jsx)(c.Ht,{client:d.queryClient,children:(0,s.jsx)(m,{...e})})}t(5497)}}]);