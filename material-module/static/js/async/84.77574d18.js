"use strict";(self.webpackChunk_portal_material_module=self.webpackChunk_portal_material_module||[]).push([["84"],{1689(){},4262(e,l,t){t.d(l,{A:()=>a});var s=t(5723);function a(e){let{title:l,subtitle:t,extra:a}=e;return(0,s.jsxs)("div",{style:{background:"#f8f8f9"},className:"flex items-center justify-between px-6 py-3 m-0",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:l}),(0,s.jsx)("span",{className:"text-xs",children:t})]}),(0,s.jsx)("div",{className:"flex gap-3",children:a})]})}},386(e,l,t){t.d(l,{o:()=>n});var s=t(5723),a=t(6646),i=t(4443),r=t(7109);function n(e){let{editItemId:l}=e,{data:t}=(0,i.I)({queryKey:["material-view",l],queryFn:()=>(0,a.U9)(l),enabled:!!l}),n=(null==t?void 0:t.data)||[];return(0,s.jsx)(r.List,{itemLayout:"horizontal",dataSource:n,renderItem:(e,l)=>(0,s.jsx)(r.List.Item,{children:(0,s.jsx)(r.List.Item.Meta,{title:e.id,description:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{children:["origin: ",e.origin]}),(0,s.jsxs)("a",{href:`https://www.ip138.com/iplookup.php?ip=${e.ip}`,target:"_blank",children:["ip: ",e.ip]})]})})},l)})}},698(e,l,t){t.d(l,{A:()=>u});var s=t(5723),a=t(4262),i=t(6646),r=t(4443),n=t(7275),d=t(7109),o=t(2833);t(1689);var c=t(386);function u(e){let{open:l,onClose:t,editItemId:u}=e,{data:x}=(0,r.I)({queryKey:["material-detail",u],queryFn:()=>(0,i.TU)(Number(u)),enabled:!!u}),h=null==x?void 0:x.data;return console.log("dataRes:",x),(0,s.jsxs)(d.Drawer,{placement:"right",size:"large",onClose:t,open:l,title:null,closable:!1,width:980,bodyStyle:{padding:0},classNames:{body:"flex flex-col overflow-hidden"},children:[(0,s.jsx)(a.A,{title:"素材详情"}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 flex gap-4",children:[(0,s.jsx)(n._,{src:(0,o.ID)(h),className:"w-36 object-cover"}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("div",{className:"text-md font-bold",children:null==h?void 0:h.fileName}),(0,s.jsxs)("div",{children:["浏览量: ",(null==h?void 0:h.viewCount)||0]})]})]}),(0,s.jsx)(d.Tabs,{className:"material-detail flex-1 overflow-hidden flex flex-col",defaultActiveKey:"1",items:[{label:"浏览记录",key:"1",children:(0,s.jsx)(c.o,{editItemId:u})}]})]})]})}},1319(e,l,t){t.d(l,{A:()=>r});var s=t(1422),a=t(6646),i=t(8760);function r(e){let l,{pn:t,ps:r,repo:n,keyword:d,ratio:o,status:c,enableRequest:u=!0}=e||{},[x,h]=(0,i.useState)(0),{fetchNextPage:f,hasNextPage:m,isFetchingNextPage:g,isPending:p,data:j,refetch:v}=(0,s.q)({queryKey:["getMaterialItem",n,d,o,c],queryFn:e=>{let{pageParam:l=1}=e;return(0,a.Jw)({pn:l,ps:r,repo:n,keyword:d,ratio:o,status:c}).then(e=>(h(e.data.total),e.data.list||[]))},initialPageParam:t,refetchOnMount:!0,getNextPageParam:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(null==e?void 0:e.length)?l.length+1:null},enabled:u}),b=(0,i.useMemo)(()=>(null==j?void 0:j.pages.flat())||[],[j]),y=(0,i.useCallback)(()=>v(),[v]);return{dataSource:b,hasNextPage:m,fetchNextPage:(l=(0,i.useRef)(),e=>{clearTimeout(l.current),l.current=window.setTimeout(()=>{f(e)},600)}),reload:y,total:x||b.length,isLoading:g||p}}},3271(e,l,t){t.r(l),t.d(l,{MaterialPicker:()=>w,MaterialPickerFeature:()=>b,MaterialPickerScene:()=>y,default:()=>k,queryClient:()=>v});var s,a,i=t(5723),r=t(7109),n=t(8760),d=t(3545),o=t(9718),c=t(1319),u=t(3467),x=t(2465),h=t(6646),f=t(639),m=t(7275),g=t(6900),p=t(7362);t(3101);var j=t(4262);let v=window.queryClient;v||(v=new d.E,window.queryClient=v);var b=((s={}).Uploader="uploader",s.Delete="delete",s.Selector="selector",s.Trash="trash",s),y=((a={}).Creator="creator",a.Trash="trash",a);function w(e){let{scene:l="creator",repo:t,open:s,onClose:a,selectLimit:d=1,onSelect:o,features:v=[],defaultRatio:b="0"}=e,[y,w]=(0,n.useState)(!1),[k,N]=(0,n.useState)(!1),[C,S]=(0,n.useState)({ratio:b,keyword:""}),{dataSource:A,total:I,fetchNextPage:q,reload:P,isLoading:L}=(0,c.A)({pn:1,ps:40,repo:t,keyword:C.keyword,ratio:C.ratio,status:"creator"===l?1:void 0,enableRequest:s}),[M,B]=(0,n.useState)([]),{mutate:F,isPending:$}=(0,f.n)({mutationFn:e=>(0,h.X6)(e,!1),onSuccess:()=>{r.message.success("删除成功"),B([]),P()}}),z=(0,n.useMemo)(()=>M.map(e=>A.find(l=>l.id===e)).filter(e=>!!e),[M,A]),T=(0,n.useMemo)(()=>v.includes("selector")||v.includes("delete"),[v]);return(0,i.jsxs)(r.Drawer,{placement:"right",size:"large",onClose:a,open:s,title:null,closable:!1,width:980,bodyStyle:{padding:0},classNames:{body:"flex flex-col overflow-hidden"},children:[(0,i.jsx)(j.A,{title:"素材库",subtitle:`${A.length}/${I} 条素材`,extra:(0,i.jsxs)(i.Fragment,{children:[v.includes("trash")&&(0,i.jsx)(r.Button,{icon:(0,i.jsx)(g.A,{theme:"filled",size:"16"}),onClick:()=>N(!0),children:"回收站"}),v.includes("delete")&&(0,i.jsxs)(r.Button,{disabled:0===M.length,onClick:()=>{F(M)},loading:$,children:["删除",M.length>0&&(0,i.jsxs)("span",{children:["(",M.length,")"]})]}),v.includes("uploader")&&(0,i.jsx)(r.Button,{type:"primary",onClick:()=>{w(!0)},children:"上传"})]})}),(0,i.jsx)(p.A,{dataSource:A,checkedIds:M,setCheckedIds:B,selectLimit:d,onLoadMore:()=>{q({})},isLoading:L,showCheckbox:T,filterValue:C,onFilterChange:S}),!!z.length&&v.includes("selector")&&(0,i.jsxs)("div",{style:{background:"#f8f8f9"},className:"p-4 flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)("span",{className:"text-xs font-medium text-gray-900",children:0===z.length?"请选择素材":`已选择 ${z.length} 个素材`}),(0,i.jsx)("div",{className:"flex items-center gap-2",children:z.map(e=>(0,i.jsx)(m._,{src:`${e.prefix}/${e.fileKey}`,alt:e.fileName,className:"w-12 h-12 object-cover",backgroundColor:"var(--color-gray-200)",closeable:!0,onClose:()=>{B(M.filter(l=>l!==e.id))}},e.id))})]}),(0,i.jsx)("div",{children:(0,i.jsx)(r.Button,{type:"primary",onClick:()=>{null==o||o(z),B([]),a()},children:"确认选择"})})]}),v.includes("uploader")&&(0,i.jsx)(u.default,{repo:t,open:y,onClose:()=>{w(!1),P()}}),v.includes("trash")&&(0,i.jsx)(x.default,{repo:t,open:k,onClose:()=>N(!1)})]})}function k(e){return(0,i.jsx)(o.Ht,{client:v,children:(0,i.jsx)(w,{...e})})}},7362(e,l,t){t.d(l,{A:()=>h});var s=t(5723),a=t(8760),i=t(7109),r=t(7275),n=t(3089),d=t(3919),o=t(8919),c=t(8275),u=t(3646),x=t(698);function h(e){let{dataSource:l,checkedIds:t,setCheckedIds:h,selectLimit:f,onLoadMore:m,isLoading:g,showCheckbox:p,filterValue:j,onFilterChange:v,renderCustomTag:b,enablePreview:y=!0,enableEdit:w=!0}=e,k=(0,a.useRef)(null),[N,C]=(0,a.useState)((null==j?void 0:j.keyword)||""),[S,A]=(0,a.useState)(0);return(0,a.useEffect)(()=>{var e;let l=e=>{var l,t,s;let a=(null==(l=e.target)?void 0:l.scrollHeight)||0,i=(null==(t=e.target)?void 0:t.scrollTop)||0;((null==(s=e.target)?void 0:s.offsetHeight)||0)+i+20>=a&&m()};return null==(e=k.current)||e.addEventListener("scroll",l),()=>{var e;null==(e=k.current)||e.removeEventListener("scroll",l)}},[]),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 flex gap-4 items-center",children:[(0,s.jsx)(d.E,{includeAllOption:!0,value:Number((null==j?void 0:j.ratio)||0),onChange:e=>{null==v||v({...j,ratio:e.toString()})}}),(0,s.jsx)("div",{className:"w-48",children:(0,s.jsx)(i.Input.Search,{width:200,placeholder:"搜索素材",allowClear:!0,value:N,onChange:e=>{C(e.target.value)},onSearch:e=>{C(e),null==v||v({...j,keyword:e})}})})]}),(0,s.jsx)("div",{ref:k,className:"grid grid-cols-5 px-4 pb-4 gap-4 overflow-auto",children:l.map(e=>{let l=t.includes(e.id),n=!l&&t.length>=f;return console.log("isChecked:",l,n,t,f),(0,s.jsxs)("div",{className:"w-full flex flex-col items-center justify-center",children:[(0,s.jsx)(c.tU,{children:d=>{let{hovered:c,bind:x}=d;return(0,a.createElement)("div",{...x,key:e.id,className:"w-full aspect-square relative p-4 cursor-pointer flex items-center justify-center",style:{background:"#f8f8f9"},onClick:()=>{n||(l?h(t.filter(l=>l!==e.id)):h([...t,e.id]))},children:[p&&(0,s.jsx)(i.Checkbox,{className:"absolute top-1 right-1 z-10",checked:t.includes(e.id),disabled:n,onChange:l=>{h(l.target.checked?[...t,e.id]:t.filter(l=>l!==e.id))}}),!!b&&(0,s.jsx)("div",{className:"absolute top-1 left-1 text-xs text-white bg-red-500 px-1 py-0.5 rounded z-10",children:b(e)}),(0,s.jsx)(r._,{src:`${e.prefix}/${e.fileKey}`,alt:e.fileName,className:"object-cover w-full",enablePreview:y}),(0,s.jsxs)("div",{className:"absolute bottom-1 right-1 flex gap-2",children:[e.format&&!c&&(0,s.jsx)("div",{className:"text-xs text-white bg-black px-1 py-0.5 rounded",children:e.format}),e.fileSize&&!c&&(0,s.jsx)("div",{className:"text-xs text-white bg-black px-1 py-0.5 rounded",children:(0,o.K)(e.fileSize)}),c&&w&&(0,s.jsx)("div",{className:"border border-solid rounded-md cursor-pointer p-1.5 bg-gray-200 shadow",onClick:l=>{l.stopPropagation(),A(e.id)},children:(0,s.jsx)(u.A,{})})]})]})}}),(0,s.jsx)("div",{className:"truncate w-full mt-1",children:e.fileName})]},e.id)})}),g&&(0,s.jsx)("div",{className:"w-full flex items-center justify-center px-4",children:(0,s.jsx)(n.Z,{})}),(0,s.jsx)(x.A,{open:!!S,onClose:()=>A(0),editItemId:S})]})}},3089(e,l,t){t.d(l,{Z:()=>a});var s=t(5723);function a(){return(0,s.jsx)("div",{className:"w-full grid grid-cols-5 gap-4",children:Array.from({length:5}).map((e,l)=>(0,s.jsx)("div",{className:"w-full aspect-square rounded-md",style:{background:"#f8f8f9"}},l))})}},2465(e,l,t){t.r(l),t.d(l,{MaterialTrash:()=>m,default:()=>g});var s=t(5723),a=t(7109),i=t(8760),r=t(9718),n=t(6646),d=t(639),o=t(1319),c=t(7362),u=t(3271),x=t(8814),h=t.n(x);t(3101);var f=t(4262);function m(e){let{repo:l,open:t,onClose:r}=e,[u,x]=(0,i.useState)({ratio:"0",keyword:""}),{dataSource:m,total:g,fetchNextPage:p,reload:j,isLoading:v}=(0,o.A)({pn:1,ps:40,repo:l,keyword:u.keyword,ratio:u.ratio,status:-1,enableRequest:t}),[b,y]=(0,i.useState)([]),{mutate:w,isPending:k}=(0,d.n)({mutationFn:e=>(0,n.zC)(e),onSuccess:()=>{a.message.success("恢复成功"),y([]),j()}}),{mutate:N,isPending:C}=(0,d.n)({mutationFn:e=>(0,n.X6)(e,!0),onSuccess:()=>{a.message.success("删除成功"),y([]),j()}});return(0,s.jsxs)(a.Drawer,{placement:"right",size:"large",onClose:r,open:t,title:null,closable:!1,width:980,bodyStyle:{padding:0},classNames:{body:"flex flex-col overflow-hidden"},children:[(0,s.jsx)(f.A,{title:"垃圾桶",subtitle:`${m.length}/${g} 条素材`,extra:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a.Button,{disabled:0===b.length,onClick:()=>{w(b)},loading:k,children:["恢复",b.length>0&&(0,s.jsxs)("span",{children:["(",b.length,")"]})]}),(0,s.jsxs)(a.Button,{danger:!0,disabled:0===b.length,onClick:()=>{N(b)},loading:C,children:["彻底删除",b.length>0&&(0,s.jsxs)("span",{children:["(",b.length,")"]})]})]})}),(0,s.jsx)(c.A,{dataSource:m,checkedIds:b,setCheckedIds:y,selectLimit:100,onLoadMore:()=>{p({})},isLoading:v,showCheckbox:!0,filterValue:u,onFilterChange:x,enablePreview:!1,renderCustomTag:e=>h()(e.updatedAt).add(30,"days").diff(h()(),"day")+"天后删除"})]})}function g(e){return(0,s.jsx)(r.Ht,{client:u.queryClient,children:(0,s.jsx)(m,{...e})})}},8919(e,l,t){t.d(l,{K:()=>s});function s(e){let l=["B","KB","MB","GB","TB","PB"],t=0;for(;e>=1024&&t<l.length-1;)e/=1024,t++;return e.toFixed(1).replace(/\.0$/,"")+l[t]}}}]);