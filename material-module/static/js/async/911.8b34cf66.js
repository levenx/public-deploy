"use strict";(self.webpackChunk_portal_material_module=self.webpackChunk_portal_material_module||[]).push([["911"],{3101(){},7065(e,l,t){t.d(l,{Q:()=>n});var a=t(8970),i=t(305),r=t(6842);function n(e){let{baseURL:l,onRequest:t,onResponse:n}=e||{},s=a.A.create({baseURL:l});return(0,i.h)(s).plugin((0,r.r)({max:3})),s.interceptors.request.use(e=>t?t(e):e),s.interceptors.response.use(e=>(null==n||n(e),e.status>=200&&e.status<300)?Promise.resolve(e.data):Promise.reject(e)),s}},5622(e,l,t){t.d(l,{U:()=>r});var a=t(5270),i=t(8628);function r(e){let{visible:l,children:t,...r}=e;return l?(0,a.jsx)(i.Badge.Ribbon,{...r,children:t}):t}},3919(e,l,t){t.d(l,{$n:()=>n,El:()=>o,PB:()=>s});var a,i=t(5270),r=t(8628),n=((a={})[a.Horizontal=1.78]="Horizontal",a[a.Square=1]="Square",a[a.Vertical=.56]="Vertical",a[a.InsertRectangle=1.2]="InsertRectangle",a[a.LargeBanner=3.2]="LargeBanner",a[a.SmallBanner=6.4]="SmallBanner",a);let s=[{label:"横版",value:1.78},{label:"正方形",value:1},{label:"竖版",value:.56},{label:"插页矩形",value:1.2},{label:"大横幅",value:3.2},{label:"小横幅",value:6.4}];function o(e){let{value:l,onChange:t,includeAllOption:a=!1,includeOtherOption:n=!1}=e;return(0,i.jsx)(r.Select,{className:"w-48",options:[...a?[{label:"全部",value:0}]:[],...s,...n?[{label:"其他",value:-1}]:[]],value:l,onChange:e=>{t(e)},allowClear:a})}},5175(e,l,t){t.d(l,{H:()=>i});var a=t(5270);function i(e){let{format:l}=e;return l?(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[l.width," x ",l.height]}):null}},7275(e,l,t){t.d(l,{_:()=>d});var a=t(5270),i=t(395),r=t.n(i),n=t(8628),s=t(4508),o=t(6239);function d(e){let{src:l,alt:t,width:i,height:d,className:c,backgroundColor:u="#f8f8f9",enablePreview:p=!0,closeable:m=!1,onClose:f}=e,[h,x]=(0,s.useState)(!1);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:r()("rounded-md relative aspect-square",c),style:{background:u},onClick:e=>{p&&e.stopPropagation()},children:[(0,a.jsx)("img",{src:l,alt:t,className:"w-full h-full object-contain",width:i,height:d,onClick:e=>{p&&(e.stopPropagation(),x(!0))}}),m&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 z-10 cursor-pointer",children:(0,a.jsx)(o.A,{theme:"filled",size:"12",fill:"#50e3c2",onClick:()=>{null==f||f(),x(!1)}})}),(0,a.jsx)("div",{className:"absolute",children:(0,a.jsx)(n.Image,{src:l,alt:t,className:"hidden",width:i,height:d,preview:{visible:h,onVisibleChange:x}})})]})})}},2462(e,l,t){t.d(l,{PF:()=>n,hz:()=>r});var a=t(4508);let i=(0,a.createContext)({repo:"",selectedFiles:[],setSelectedFiles:()=>{}}),r=i.Provider,n=()=>(0,a.useContext)(i)},24(e,l,t){t.d(l,{o:()=>a});function a(e){let{selectedFiles:l,setCurrentStep:t,onClose:a}=e;return{0:{stepIndex:1,title:"选择图片",nextStep:1,prevButton:{text:"返回",onClick:a},nextButton:{text:"下一步",disabled:0===l.length,onClick:()=>t(1)}},1:{stepIndex:2,title:"裁剪图片",nextStep:2,prevButton:{text:"取消",onClick:()=>t(0)},nextButton:{text:"确认",disabled:0===l.length,onClick:()=>t(2)}},2:{stepIndex:3,title:"上传图片",nextStep:0,prevButton:{text:"返回",onClick:()=>t(0)},nextButton:{text:"完成",disabled:0===l.length||l.some(e=>!e.result),onClick:a}}}}},3467(e,l,t){t.r(l),t.d(l,{default:()=>x,renderMaterialUploader:()=>g});var a=t(5270),i=t(4508),r=t(8628),n=t(8233),s=t(9768),o=t(9877),d=t(2462),c=t(24),u=t(2987),p=t(6020),m=t(8509),f=t(2833);t(3101);var h=t(2792);function x(e){let{repo:l,open:t,onClose:u,defaultImages:x}=e,[g,v]=(0,i.useState)(0),[j,w]=(0,i.useState)([]),b=(0,c.o)({selectedFiles:j,setCurrentStep:v,onClose:u})[g];return(0,i.useEffect)(()=>{t&&(async()=>{let e=await Promise.all((null==x?void 0:x.filter(e=>(0,h.A)(e)).map(e=>(0,f.WF)(e)))||[]).catch(e=>(r.message.error(e.message||"获取默认图片失败"),[]));e.push(...(null==x?void 0:x.filter(e=>e instanceof File))||[]);let l=[];for(let t of e){let e=await (0,m.pG)(t);l.push({uploadId:(0,p.Ak)(),originalFile:{file:t,type:t.type,format:{width:e.width,height:e.height},url:URL.createObjectURL(t)},source:"init"})}w(e=>[...e,...l])})()},[t]),(0,i.useEffect)(()=>{t&&(async()=>{for(let e of(await navigator.clipboard.read()))for(let l of e.types){if(!l.startsWith("image/"))continue;let t=await e.getType(l),a=URL.createObjectURL(t),i=await (0,f.WF)(a),r=await (0,m.pG)(i);w(e=>[...e,{uploadId:(0,p.Ak)(),originalFile:{file:i,type:t.type,format:{width:r.width,height:r.height},url:a},source:"clipboard"}])}})()},[t]),(0,a.jsx)(d.hz,{value:{repo:l,selectedFiles:j,setSelectedFiles:w},children:(0,a.jsxs)(r.Drawer,{title:"素材上传",width:1080,closable:!1,onClose:()=>{u(),v(0)},open:t,footer:null,classNames:{body:"flex flex-col !p-0"},children:[(0,a.jsxs)("div",{className:"p-4 flex-1",children:[(0,a.jsxs)("div",{className:"text-md font-medium flex items-center gap-1",children:[(0,a.jsxs)("span",{children:["第 ",g+1," 步 (共",3,"步):"]}),(0,a.jsx)("span",{children:b.title})]}),(0,a.jsxs)("div",{className:"mt-4",children:[0===g&&(0,a.jsx)(n.W,{}),1===g&&(0,a.jsx)(s.D,{}),2===g&&(0,a.jsx)(o.q,{})]})]}),(0,a.jsxs)("div",{className:"h-20 border-t border-solid border-gray-200 flex items-center justify-between px-4",children:[(0,a.jsx)("div",{}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(r.Button,{onClick:()=>{b.prevButton.onClick()},children:b.prevButton.text}),(0,a.jsx)(r.Button,{type:"primary",disabled:b.nextButton.disabled,onClick:()=>{2===g?(v(0),u(j.map(e=>e.result).filter(e=>!!e)??[]),w([])):v(g+1)},children:b.nextButton.text})]})]})]})})}let g=e=>{let l=document.createElement("div");document.body.appendChild(l);let t=(0,u.createRoot)(l);t.render((0,a.jsx)(x,{repo:e,open:!0,onClose:()=>{t.unmount(),document.body.removeChild(l)}}))}},9768(e,l,t){t.d(l,{D:()=>m});var a=t(5270),i=t(4508),r=t(7440),n=t(2462),s=t(7275),o=t(5175),d=t(8509),c=t(395),u=t.n(c),p=t(3919);function m(){let{selectedFiles:e,setSelectedFiles:l}=(0,n.PF)(),[t,c]=(0,i.useState)(()=>{var l;return null==(l=e[0])?void 0:l.uploadId}),m=(0,i.useMemo)(()=>e.find(e=>e.uploadId===t),[e,t]),f=(0,i.useMemo)(()=>null==m?void 0:m.originalFile,[m]),h=(0,i.useMemo)(()=>null==m?void 0:m.croppedFile,[m]),x=(0,i.useMemo)(()=>{let e=p.PB.find(e=>e.value===(null==m?void 0:m.ratio));return(null==e?void 0:e.value)||p.PB["0"].value},[m]),[g,v]=(0,i.useState)({x:2,y:2}),[j,w]=(0,i.useState)(1),b=(0,i.useRef)(null);return(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-36 flex flex-col gap-4",children:e.map(e=>{var l;return(0,a.jsx)("div",{className:u()("bg-gray-100 flex gap-3 items-center aspect-square rounded-md cursor-pointer",{"border border-solid border-gray-400":e.uploadId===t}),onClick:()=>c(e.uploadId),children:(0,a.jsx)(s._,{src:null==(l=e.originalFile)?void 0:l.url,alt:e.originalFile.file.name,enablePreview:!1})},e.uploadId)})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{children:(0,a.jsx)(p.El,{value:x,onChange:a=>{l([...e.map(e=>e.uploadId===t?{...e,ratio:a}:e)])}})})]}),(0,a.jsx)("div",{className:"w-full h-96 relative",children:f&&(0,a.jsx)(r.Ay,{ref:b,showGrid:!0,objectFit:"contain",style:{containerStyle:{width:"100%",height:"460px"}},image:f.url,crop:g,zoom:j,aspect:x,onCropChange:v,onZoomChange:w,onCropComplete:async(a,i)=>{let r=await (0,d.nJ)(f.url,i,0,f.file.name);l([...e.map(e=>e.uploadId===t?{...e,croppedFile:{file:r.file,type:r.type,format:r.format,url:URL.createObjectURL(r.file)}}:e)])}},x)})]}),(0,a.jsxs)("div",{className:"w-48 flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:"预览"}),h&&(0,a.jsx)(s._,{src:h.url,alt:(null==f?void 0:f.file.name)||"",className:"w-full aspect-square overflow-hidden",enablePreview:!0})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:"尺寸"}),(0,a.jsx)(o.H,{format:(null==h?void 0:h.format)||(null==f?void 0:f.format)})]})]})]})}},9877(e,l,t){t.d(l,{q:()=>m});var a=t(5270),i=t(4508),r=t(2462),n=t(7275),s=t(5175),o=t(9179),d=t(722),c=t(7512),u=t(6646),p=t(8628);function m(){let{repo:e,selectedFiles:l,setSelectedFiles:t}=(0,r.PF)(),m=async l=>{let a=new FormData;if(l.croppedFile){var i,r,n,s;a.append("file",null==(i=l.croppedFile)?void 0:i.file),a.append("repo",e),a.append("format",(null==(r=l.croppedFile)?void 0:r.format.width)+"x"+(null==(n=l.croppedFile)?void 0:n.format.height)),a.append("type",null==(s=l.croppedFile)?void 0:s.type)}(0,u.Fq)(a,{onUploadProgress:e=>{l.uploadInfo={progress:Math.round(100*e.loaded/(e.total||1))-20,status:"uploading"},t(e=>{let t=[...e];return t[t.indexOf(l)]=l,t})}}).then(e=>{0===e.code?(l.uploadInfo={progress:100,status:"success"},l.result=e.data):(p.message.error("上传失败,"+e.message,10),l.uploadInfo={progress:100,status:"error",message:e.message}),t(e=>{let t=[...e];return t[t.indexOf(l)]=l,t})}).catch(e=>{p.message.error("上传失败,"+e.message,10),l.uploadInfo={progress:0,status:"error"},t(e=>{let t=[...e];return t[t.indexOf(l)]=l,t})})};return(0,i.useEffect)(()=>{l.filter(e=>!e.uploadInfo).forEach(e=>{m(e)})},[]),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"flex flex-col gap-4",style:{width:660},children:l.map(e=>{var l,t,i,r,u,f,h,x,g,v;return(0,a.jsxs)("div",{className:"p-3 rounded-md bg-gray-100 flex items-center gap-4 overflow-hidden",children:[(0,a.jsx)(n._,{src:(null==(l=e.croppedFile)?void 0:l.url)||"",className:"w-18 h-18",enablePreview:!1}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 flex-1 overflow-hidden",children:[(0,a.jsx)("span",{className:"text-lg font-bold truncate",children:null==(i=e.originalFile)||null==(t=i.file)?void 0:t.name}),(0,a.jsx)(s.H,{format:null==(r=e.croppedFile)?void 0:r.format}),(null==(u=e.uploadInfo)?void 0:u.status)==="uploading"&&(0,a.jsx)(p.Progress,{percent:(null==(f=e.uploadInfo)?void 0:f.progress)||0,size:"small",showInfo:!1,trailColor:(null==(h=e.uploadInfo)?void 0:h.progress)<50?"#f3f3f3":"#e0e0e0"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(null==(x=e.uploadInfo)?void 0:x.status)==="success"&&(0,a.jsx)(o.A,{theme:"filled",size:18,fill:"green"}),(null==(g=e.uploadInfo)?void 0:g.status)==="error"&&(0,a.jsx)(p.Tooltip,{title:(null==(v=e.uploadInfo)?void 0:v.message)||"",children:(0,a.jsx)(d.A,{theme:"filled",size:"24",fill:"red",className:"cursor-pointer",onClick:()=>m(e)})}),(0,a.jsx)(c.A,{size:18})]})]},e.uploadId)})})})}},8233(e,l,t){t.d(l,{W:()=>g});var a=t(5270),i=t(4508),r=t(6552),n=t(1771),s=t(7512),o=t(7275),d=t(5175),c=t(8509),u=t(2462),p=t(6020),m=t(8628),f=t(9625),h=t(1008),x=t(5622);function g(){let{selectedFiles:e,setSelectedFiles:l}=(0,u.PF)(),t=(0,i.useRef)(null),[g,v]=(0,i.useState)("");return(0,a.jsxs)("div",{className:"my-4 flex flex-col gap-8",children:[(0,a.jsxs)("div",{className:"h-40 flex flex-col gap-2 items-center justify-center border border-dashed border-gray-300 rounded-md cursor-pointer hover:border-gray-600",style:{width:660},onClick:()=>{var e;return null==(e=t.current)?void 0:e.click()},children:[(0,a.jsx)(r.A,{size:32,className:"text-gray-400"}),(0,a.jsx)("span",{className:"ml-2 text-gray-400",children:"请选择要上传的素材"}),(0,a.jsx)("input",{ref:t,type:"file",className:"hidden",onChange:async e=>{let a=e.target.files;if(null==a?void 0:a.length){let e=a[0],t=await (0,c.pG)(e);l(l=>[...l,{uploadId:(0,p.Ak)(),originalFile:{file:e,format:t,url:URL.createObjectURL(e)},ratio:t.width/t.height}])}setTimeout(()=>{t.current&&(t.current.value="")},300)}})]}),(0,a.jsx)("div",{className:"flex flex-col gap-4",style:{width:660},children:e.map(e=>(0,a.jsx)(x.U,{visible:"clipboard"===e.source,text:"剪切板",children:(0,a.jsxs)("div",{className:"p-4 bg-gray-100 flex gap-3 items-center",children:[(0,a.jsx)(o._,{src:e.originalFile.url,alt:e.originalFile.file.name,className:"w-12 h-12",enablePreview:!1}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 flex-1 overflow-hidden",children:[(0,a.jsxs)("div",{className:"font-medium flex items-center gap-1 overflow-hidden",children:[(0,a.jsx)("span",{className:"truncate",children:e.originalFile.file.name}),(0,a.jsx)(m.Popover,{open:g===e.uploadId,title:(0,a.jsx)(f.w,{name:e.originalFile.file.name,onSubmit:t=>{l(l=>{let a=[...l],i=a.findIndex(l=>l.uploadId===e.uploadId);return -1!==i&&(a[i].originalFile.file=(0,h.H)(a[i].originalFile.file,t)),a}),v("")},onCancel:()=>{v("")}}),children:(0,a.jsx)(n.A,{className:" cursor-pointer",size:14,onClick:()=>v(e.uploadId)})})]}),(0,a.jsx)(d.H,{format:e.originalFile.format})]}),(0,a.jsx)(s.A,{className:"cursor-pointer",onClick:()=>l(l=>l.filter(l=>l.originalFile.file.name!==e.originalFile.file.name))})]})},e.originalFile.file.name))})]})}},9625(e,l,t){t.d(l,{w:()=>n});var a=t(5270),i=t(4508),r=t(8628);function n(e){let{name:l,onSubmit:t,onCancel:n}=e,[s,o]=(0,i.useState)(l);return(0,a.jsxs)("div",{className:"flex flex-col items-start gap-4",style:{width:400},children:[(0,a.jsx)("div",{children:"素材名称"}),(0,a.jsx)(r.Input,{value:s,onChange:e=>o(e.target.value)}),(0,a.jsxs)("div",{className:"flex gap-4 justify-end w-full",children:[(0,a.jsx)(r.Button,{size:"small",onClick:()=>n(),children:"取消"}),(0,a.jsx)(r.Button,{size:"small",type:"primary",onClick:()=>t(s),children:"确定"})]})]})}},3463(e,l,t){t.d(l,{A:()=>a});let a=(0,t(7065).Q)({baseURL:"https://www.levenx.com"})},6646(e,l,t){t.d(l,{Fq:()=>n,Jw:()=>i,TU:()=>r,U9:()=>d,X6:()=>o,q3:()=>c,zC:()=>s});var a=t(3463);let i=e=>a.A.get("/admin/material/item",{params:e}),r=e=>a.A.get(`/admin/material/item/only/${e}`),n=(e,l)=>a.A.post("/admin/material/upload/new",e,{onUploadProgress:e=>{var t;null==l||null==(t=l.onUploadProgress)||t.call(l,e)}}),s=e=>a.A.put("/admin/material/item/restore/batch",{ids:e}),o=(e,l)=>a.A.post("/admin/material/item/delete/batch",{ids:e,isHardDelete:l}),d=e=>a.A.get(`/admin/material/item/view/${e}`),c=e=>a.A.put("/admin/material/item",e)},1008(e,l,t){function a(e,l){return new File([e],l,{type:e.type,lastModified:e.lastModified})}function i(e){var l;return({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp",webp:"image/webp",svg:"image/svg+xml",ico:"image/x-icon",tif:"image/tiff",tiff:"image/tiff"})[(null==(l=e.split(".").pop())?void 0:l.toLowerCase())||""]||"application/octet-stream"}t.d(l,{$:()=>i,H:()=>a})},8509(e,l,t){async function a(e){let l=URL.createObjectURL(e),t=new Image;return new Promise((e,a)=>{t.onload=function(){e({width:t.width,height:t.height}),URL.revokeObjectURL(l)},t.onerror=a,t.src=l})}async function i(e,l){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,i=await new Promise((l,t)=>{let a=new Image;a.addEventListener("load",()=>l(a)),a.addEventListener("error",e=>t(e)),a.setAttribute("crossOrigin","anonymous"),a.src=e}),r=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw Error("Canvas context is not available");let s=Math.max(i.width,i.height)/2*Math.sqrt(2)*2;r.width=s,r.height=s,n.translate(s/2,s/2),n.rotate(t*Math.PI/180),n.translate(-s/2,-s/2),n.drawImage(i,s/2-.5*i.width,s/2-.5*i.height);let o=n.getImageData(0,0,s,s);return r.width=l.width,r.height=l.height,n.putImageData(o,Math.round(0-s/2+.5*i.width-l.x),Math.round(0-s/2+.5*i.height-l.y)),{file:await new Promise(e=>{r.toBlob(l=>{if(!l)throw Error("Canvas to blob conversion failed");e(new File([l],a.split(".")[0]+".webp",{type:"image/webp"}))},"image/webp")}),type:"image/webp",format:{width:l.width,height:l.height}}}t.d(l,{nJ:()=>i,pG:()=>a})},2833(e,l,t){t.d(l,{ID:()=>i,WF:()=>r});var a=t(1008);let i=e=>(null==e?void 0:e.prefix)&&(null==e?void 0:e.fileKey)?`${null==e?void 0:e.prefix}/${null==e?void 0:e.fileKey}`:"";async function r(e,l){return new Promise((t,i)=>{let r=new Image;r.crossOrigin="anonymous",r.src=e,r.onload=()=>{let n=document.createElement("canvas");n.width=r.naturalWidth,n.height=r.naturalHeight;let s=n.getContext("2d");s?(s.drawImage(r,0,0),n.toBlob(r=>{if(!r)return void i(Error("Canvas is empty"));let n=l;n||(n=function(e){try{let l=new URL(e).pathname;return l.substring(l.lastIndexOf("/")+1)||"unknown"}catch{return"unknown"}}(e));let s=(0,a.$)(n);t(new File([r],n,{type:s}))},"image/png")):i(Error("Cannot get canvas context"))},r.onerror=()=>{i(Error("Image load error"))}})}},8488(){}}]);