"use strict";(self.webpackChunk_portal_material_module=self.webpackChunk_portal_material_module||[]).push([["84"],{1689(){},4262(e,l,t){t.d(l,{A:()=>a});var s=t(5723);function a(e){let{title:l,subtitle:t,extra:a}=e;return(0,s.jsxs)("div",{style:{background:"#f8f8f9"},className:"flex items-center justify-between px-6 py-3 m-0",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:l}),(0,s.jsx)("span",{className:"text-xs",children:t})]}),(0,s.jsx)("div",{className:"flex gap-3",children:a})]})}},8231(e,l,t){t.d(l,{g:()=>o});var s=t(5723),a=t(8760),r=t(889),n=t(8168),i=t(3646),d=t(7109);function o(e){let{value:l,onEdit:t}=e,[o,c]=(0,a.useState)(l||""),[u,x]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{c(l)},[l]),u)?(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(d.Input,{value:o,onChange:e=>c(e.target.value),onPressEnter:e=>{"Enter"===e.key&&(x(!1),t(o))}}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(r.A,{onClick:()=>x(!1),size:18,className:"cursor-pointer"}),(0,s.jsx)(n.A,{onClick:()=>{x(!1),t(o)},size:18,className:"cursor-pointer"})]})]}):(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)("div",{className:"text-md font-bold",children:e.value}),(0,s.jsx)(i.A,{onClick:()=>x(!0),size:18,className:"cursor-pointer"})]})}},3733(e,l,t){t.d(l,{J:()=>n});var s=t(5723),a=t(7109);let r=[{value:"ASC",label:"升序"},{value:"DESC",label:"降序"}];function n(e){let{value:l,onChange:t}=e;return(0,s.jsx)(a.Cascader,{options:[{value:"updatedAt",label:"更新时间",children:r},{value:"createdAt",label:"创建时间",children:r},{value:"fileSize",label:"文件大小",children:r}],value:l,onChange:e=>{console.log(e),null==t||t(e)}})}},386(e,l,t){t.d(l,{o:()=>i});var s=t(5723),a=t(6646),r=t(4443),n=t(7109);function i(e){let{editItemId:l}=e,{data:t}=(0,r.I)({queryKey:["material-view",l],queryFn:()=>(0,a.U9)(l),enabled:!!l}),i=(null==t?void 0:t.data)||[];return(0,s.jsx)(n.List,{itemLayout:"horizontal",dataSource:i,renderItem:(e,l)=>(0,s.jsx)(n.List.Item,{children:(0,s.jsx)(n.List.Item.Meta,{title:e.id,description:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{children:["origin: ",e.origin]}),(0,s.jsxs)("a",{href:`https://www.ip138.com/iplookup.php?ip=${e.ip}`,target:"_blank",children:["ip: ",e.ip]})]})})},l)})}},698(e,l,t){t.d(l,{A:()=>x});var s=t(5723),a=t(4262),r=t(6646),n=t(4443),i=t(7275),d=t(7109),o=t(2833);t(1689);var c=t(386),u=t(8231);function x(e){let{open:l,onClose:t,onReload:x,editItemId:h}=e,{data:f,refetch:m}=(0,n.I)({queryKey:["material-detail",h],queryFn:()=>(0,r.TU)(Number(h)),enabled:!!h}),g=null==f?void 0:f.data;return(0,s.jsxs)(d.Drawer,{placement:"right",size:"large",onClose:t,open:l,title:null,closable:!1,width:980,bodyStyle:{padding:0},classNames:{body:"flex flex-col overflow-hidden"},children:[(0,s.jsx)(a.A,{title:"素材详情"}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 flex gap-4",children:[(0,s.jsx)(i._,{src:(0,o.ID)(g),className:"w-36 object-cover"}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)(u.g,{value:null==g?void 0:g.fileName,onEdit:async e=>{await (0,r.q3)({id:h,fileName:e}),m(),null==x||x()}}),(0,s.jsxs)("div",{children:["浏览量: ",(null==g?void 0:g.viewCount)||0]})]})]}),(0,s.jsx)(d.Tabs,{className:"material-detail flex-1 overflow-hidden flex flex-col",defaultActiveKey:"1",items:[{label:"浏览记录",key:"1",children:(0,s.jsx)(c.o,{editItemId:h})}]})]})]})}},1319(e,l,t){t.d(l,{A:()=>n});var s=t(1422),a=t(6646),r=t(8760);function n(e){let l,{pn:t,ps:n,repo:i,keyword:d,ratio:o,sorter:c,status:u,enableRequest:x=!0}=e||{},[h,f]=(0,r.useState)(0),{fetchNextPage:m,hasNextPage:g,isFetchingNextPage:p,isPending:v,data:j,refetch:b}=(0,s.q)({queryKey:["getMaterialItem",i,d,o,u,null==c?void 0:c.join()],queryFn:e=>{let{pageParam:l=1}=e;return(0,a.Jw)({pn:l,ps:n,repo:i,keyword:d,ratio:o,sorter:c,status:u}).then(e=>(f(e.data.total),e.data.list||[]))},initialPageParam:t,refetchOnMount:!0,getNextPageParam:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(null==e?void 0:e.length)?l.length+1:null},enabled:x}),y=(0,r.useMemo)(()=>(null==j?void 0:j.pages.flat())||[],[j]),w=(0,r.useCallback)(()=>b(),[b]);return{dataSource:y,hasNextPage:g,fetchNextPage:(l=(0,r.useRef)(),e=>{clearTimeout(l.current),l.current=window.setTimeout(()=>{m(e)},600)}),reload:w,total:h||y.length,isLoading:p||v}}},3271(e,l,t){t.r(l),t.d(l,{MaterialPicker:()=>w,MaterialPickerFeature:()=>b,MaterialPickerScene:()=>y,default:()=>C,queryClient:()=>j});var s,a,r=t(5723),n=t(7109),i=t(8760),d=t(3545),o=t(9718),c=t(1319),u=t(3467),x=t(2465),h=t(6646),f=t(639),m=t(7275),g=t(6900),p=t(7362),v=t(4262);t(3919),t(3101);let j=window.queryClient;j||(j=new d.E,window.queryClient=j);var b=((s={}).Uploader="uploader",s.Delete="delete",s.Selector="selector",s.Trash="trash",s),y=((a={}).Creator="creator",a.Trash="trash",a);function w(e){let{scene:l="creator",repo:t,open:s,onClose:a,selectLimit:d=1,onSelect:o,features:j=[],defaultRatio:b=1.78}=e,[y,w]=(0,i.useState)(!1),[C,N]=(0,i.useState)(!1),[k,S]=(0,i.useState)({ratio:b.toString(),keyword:"",sorter:["updatedAt","DESC"]}),{dataSource:A,total:I,fetchNextPage:q,reload:P,isLoading:z}=(0,c.A)({pn:1,ps:40,repo:t,keyword:k.keyword,ratio:k.ratio,sorter:k.sorter,status:"creator"===l?1:void 0,enableRequest:s}),[E,L]=(0,i.useState)([]),{mutate:M,isPending:B}=(0,f.n)({mutationFn:e=>(0,h.X6)(e,!1),onSuccess:()=>{n.message.success("删除成功"),L([]),P()}}),F=(0,i.useMemo)(()=>E.map(e=>A.find(l=>l.id===e)).filter(e=>!!e),[E,A]),$=(0,i.useMemo)(()=>j.includes("selector")||j.includes("delete"),[j]);return(0,r.jsxs)(n.Drawer,{placement:"right",size:"large",onClose:a,open:s,title:null,closable:!1,width:980,bodyStyle:{padding:0},classNames:{body:"flex flex-col overflow-hidden"},children:[(0,r.jsx)(v.A,{title:"素材库",subtitle:`${A.length}/${I} 条素材`,extra:(0,r.jsxs)(r.Fragment,{children:[j.includes("trash")&&(0,r.jsx)(n.Button,{icon:(0,r.jsx)(g.A,{theme:"filled",size:"16"}),onClick:()=>N(!0),children:"回收站"}),j.includes("delete")&&(0,r.jsxs)(n.Button,{disabled:0===E.length,onClick:()=>{M(E)},loading:B,children:["删除",E.length>0&&(0,r.jsxs)("span",{children:["(",E.length,")"]})]}),j.includes("uploader")&&(0,r.jsx)(n.Button,{type:"primary",onClick:()=>{w(!0)},children:"上传"})]})}),(0,r.jsx)(p.A,{dataSource:A,checkedIds:E,setCheckedIds:L,selectLimit:d,onLoadMore:()=>{q({})},onReload:P,isLoading:z,showCheckbox:$,filterValue:k,onFilterChange:S}),!!F.length&&j.includes("selector")&&(0,r.jsxs)("div",{style:{background:"#f8f8f9"},className:"p-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-gray-900",children:0===F.length?"请选择素材":`已选择 ${F.length} 个素材`}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:F.map(e=>(0,r.jsx)(m._,{src:`${e.prefix}/${e.fileKey}`,alt:e.fileName,className:"w-12 h-12 object-cover",backgroundColor:"var(--color-gray-200)",closeable:!0,onClose:()=>{L(E.filter(l=>l!==e.id))}},e.id))})]}),(0,r.jsx)("div",{children:(0,r.jsx)(n.Button,{type:"primary",onClick:()=>{null==o||o(F),L([]),a()},children:"确认选择"})})]}),j.includes("uploader")&&(0,r.jsx)(u.default,{repo:t,open:y,onClose:()=>{w(!1),P()}}),j.includes("trash")&&(0,r.jsx)(x.default,{repo:t,open:C,onClose:()=>N(!1)})]})}function C(e){return(0,r.jsx)(o.Ht,{client:j,children:(0,r.jsx)(w,{...e})})}},7362(e,l,t){t.d(l,{A:()=>f});var s=t(5723),a=t(8760),r=t(7109),n=t(7275),i=t(3089),d=t(3919),o=t(8919),c=t(8275),u=t(3646),x=t(698),h=t(3733);function f(e){let{dataSource:l,checkedIds:t,setCheckedIds:f,selectLimit:m,onLoadMore:g,onReload:p,isLoading:v,showCheckbox:j,filterValue:b,onFilterChange:y,renderCustomTag:w,enablePreview:C=!0,enableEdit:N=!0}=e,k=(0,a.useRef)(null),[S,A]=(0,a.useState)((null==b?void 0:b.keyword)||""),[I,q]=(0,a.useState)(0);return(0,a.useEffect)(()=>{var e;let l=e=>{var l,t,s;let a=(null==(l=e.target)?void 0:l.scrollHeight)||0,r=(null==(t=e.target)?void 0:t.scrollTop)||0;((null==(s=e.target)?void 0:s.offsetHeight)||0)+r+20>=a&&g()};return null==(e=k.current)||e.addEventListener("scroll",l),()=>{var e;null==(e=k.current)||e.removeEventListener("scroll",l)}},[]),(0,s.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 flex gap-4 items-center",children:[(0,s.jsx)(d.El,{includeAllOption:!0,value:Number((null==b?void 0:b.ratio)||0),onChange:e=>{null==y||y({...b,ratio:e.toString()})}}),(0,s.jsx)(h.J,{value:(null==b?void 0:b.sorter)||[],onChange:e=>{null==y||y({...b,sorter:e})}}),(0,s.jsx)("div",{className:"w-48",children:(0,s.jsx)(r.Input.Search,{width:200,placeholder:"搜索素材",allowClear:!0,value:S,onChange:e=>{A(e.target.value)},onSearch:e=>{A(e),null==y||y({...b,keyword:e})}})})]}),(0,s.jsx)("div",{ref:k,className:"grid grid-cols-5 px-4 pb-4 gap-4 overflow-auto",children:l.map(e=>{let l=t.includes(e.id),i=!l&&t.length>=m;return console.log("isChecked:",l,i,t,m),(0,s.jsxs)("div",{className:"w-full flex flex-col items-center justify-center",children:[(0,s.jsx)(c.tU,{children:d=>{let{hovered:c,bind:x}=d;return(0,a.createElement)("div",{...x,key:e.id,className:"w-full aspect-square relative p-4 cursor-pointer flex items-center justify-center",style:{background:"#f8f8f9"},onClick:()=>{i||(l?f(t.filter(l=>l!==e.id)):f([...t,e.id]))},children:[j&&(0,s.jsx)(r.Checkbox,{className:"absolute top-1 right-1 z-10",checked:t.includes(e.id),disabled:i,onChange:l=>{f(l.target.checked?[...t,e.id]:t.filter(l=>l!==e.id))}}),!!w&&(0,s.jsx)("div",{className:"absolute top-1 left-1 text-xs text-white bg-red-500 px-1 py-0.5 rounded z-10",children:w(e)}),(0,s.jsx)(n._,{src:`${e.prefix}/${e.fileKey}`,alt:e.fileName,className:"object-cover w-full",enablePreview:C}),(0,s.jsxs)("div",{className:"absolute bottom-1 right-1 flex gap-2",children:[e.format&&!c&&(0,s.jsx)("div",{className:"text-xs text-white bg-black px-1 py-0.5 rounded",children:e.format}),e.fileSize&&!c&&(0,s.jsx)("div",{className:"text-xs text-white bg-black px-1 py-0.5 rounded",children:(0,o.K)(e.fileSize)}),c&&N&&(0,s.jsx)("div",{className:"border border-solid rounded-md cursor-pointer p-1.5 bg-gray-200 shadow",onClick:l=>{l.stopPropagation(),q(e.id)},children:(0,s.jsx)(u.A,{})})]})]})}}),(0,s.jsx)("div",{className:"truncate w-full mt-1",children:e.fileName})]},e.id)})}),v&&(0,s.jsx)("div",{className:"w-full flex items-center justify-center px-4",children:(0,s.jsx)(i.Z,{})}),N&&(0,s.jsx)(x.A,{open:!!I,onClose:()=>q(0),editItemId:I,onReload:p})]})}},3089(e,l,t){t.d(l,{Z:()=>a});var s=t(5723);function a(){return(0,s.jsx)("div",{className:"w-full grid grid-cols-5 gap-4",children:Array.from({length:5}).map((e,l)=>(0,s.jsx)("div",{className:"w-full aspect-square rounded-md",style:{background:"#f8f8f9"}},l))})}},2465(e,l,t){t.r(l),t.d(l,{MaterialTrash:()=>m,default:()=>g});var s=t(5723),a=t(7109),r=t(8760),n=t(9718),i=t(6646),d=t(639),o=t(1319),c=t(7362),u=t(3271),x=t(8814),h=t.n(x);t(3101);var f=t(4262);function m(e){let{repo:l,open:t,onClose:n}=e,[u,x]=(0,r.useState)({ratio:"0",keyword:"",sorter:["updatedAt","DESC"]}),{dataSource:m,total:g,fetchNextPage:p,reload:v,isLoading:j}=(0,o.A)({pn:1,ps:40,repo:l,keyword:u.keyword,ratio:u.ratio,sorter:u.sorter,status:-1,enableRequest:t}),[b,y]=(0,r.useState)([]),{mutate:w,isPending:C}=(0,d.n)({mutationFn:e=>(0,i.zC)(e),onSuccess:()=>{a.message.success("恢复成功"),y([]),v()}}),{mutate:N,isPending:k}=(0,d.n)({mutationFn:e=>(0,i.X6)(e,!0),onSuccess:()=>{a.message.success("删除成功"),y([]),v()}});return(0,s.jsxs)(a.Drawer,{placement:"right",size:"large",onClose:n,open:t,title:null,closable:!1,width:980,bodyStyle:{padding:0},classNames:{body:"flex flex-col overflow-hidden"},children:[(0,s.jsx)(f.A,{title:"垃圾桶",subtitle:`${m.length}/${g} 条素材`,extra:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a.Button,{disabled:0===b.length,onClick:()=>{w(b)},loading:C,children:["恢复",b.length>0&&(0,s.jsxs)("span",{children:["(",b.length,")"]})]}),(0,s.jsxs)(a.Button,{danger:!0,disabled:0===b.length,onClick:()=>{N(b)},loading:k,children:["彻底删除",b.length>0&&(0,s.jsxs)("span",{children:["(",b.length,")"]})]})]})}),(0,s.jsx)(c.A,{dataSource:m,checkedIds:b,setCheckedIds:y,selectLimit:100,onLoadMore:()=>{p({})},isLoading:j,showCheckbox:!0,filterValue:u,onFilterChange:x,enablePreview:!1,renderCustomTag:e=>h()(e.updatedAt).add(30,"days").diff(h()(),"day")+"天后删除"})]})}function g(e){return(0,s.jsx)(n.Ht,{client:u.queryClient,children:(0,s.jsx)(m,{...e})})}},8919(e,l,t){t.d(l,{K:()=>s});function s(e){let l=["B","KB","MB","GB","TB","PB"],t=0;for(;e>=1024&&t<l.length-1;)e/=1024,t++;return e.toFixed(1).replace(/\.0$/,"")+l[t]}}}]);